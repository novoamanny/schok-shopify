(function($) {
  var CustomerAddresses = {
    selectors: {
      customerAddresses: '[data-customer-addresses]',
      addressCountrySelect: '[data-address-country-select]',
      addressContainer: '[data-address]',
      toggleAddressButton: 'button[aria-expanded]',
      cancelAddressButton: 'button[type="reset"]',
      deleteAddressButton: 'button[data-confirm-message]'
    },
    attributes: {
      expanded: 'aria-expanded',
      confirmMessage: 'data-confirm-message'
    },
    init: function() {
      CustomerAddresses.elements = CustomerAddresses.getElements();
      if (Object.keys(CustomerAddresses.elements).length === 0) {
        return;
      }
      CustomerAddresses.setupCountries();
      CustomerAddresses.setupEventListeners();
    },
    getElements: function() {
      var container = $(CustomerAddresses.selectors.customerAddresses);
      return {
        container: container,
        addressContainer: container.find(CustomerAddresses.selectors.addressContainer),
        toggleButtons: container.find(CustomerAddresses.selectors.toggleAddressButton),
        cancelButtons: container.find(CustomerAddresses.selectors.cancelAddressButton),
        deleteButtons: container.find(CustomerAddresses.selectors.deleteAddressButton),
        countrySelects: container.find(CustomerAddresses.selectors.addressCountrySelect)
      };
    },
    setupCountries: function() {
      if (Shopify && Shopify.CountryProvinceSelector) {
        // eslint-disable-next-line no-new
        new Shopify.CountryProvinceSelector('AddressCountryNew', 'AddressProvinceNew', {
          hideElement: 'AddressProvinceContainerNew'
        });
        CustomerAddresses.elements.countrySelects.each(function() {
          var select = $(this);
          var formId = select.data('form-id');
          // eslint-disable-next-line no-new
          new Shopify.CountryProvinceSelector('AddressCountry_' + formId, 'AddressProvince_' + formId, {
            hideElement: 'AddressProvinceContainer_' + formId
          });
        });
      }
    },
    setupEventListeners: function() {

      CustomerAddresses.elements.toggleButtons.each(function() {
        $(this).on('click', CustomerAddresses.handleAddEditButtonClick);
      });
      CustomerAddresses.elements.cancelButtons.each(function() {
        $(this).on('click', CustomerAddresses.handleCancelButtonClick);
      });
      CustomerAddresses.elements.deleteButtons.each(function() {
        $(this).on('click', CustomerAddresses.handleDeleteButtonClick);
      });
    },
    toggleExpanded: function(target) {
      target.setAttribute(
        CustomerAddresses.attributes.expanded,
        (target.getAttribute(CustomerAddresses.attributes.expanded) === 'false').toString()
      );
    },
    handleAddEditButtonClick: function(e) {
      CustomerAddresses.toggleExpanded(e.target);
    },
    handleCancelButtonClick: function(e) {
      CustomerAddresses.toggleExpanded(
        e.target
        .closest(CustomerAddresses.selectors.addressContainer)
        .querySelector('[' + CustomerAddresses.attributes.expanded + ']')
      );
    },
    handleDeleteButtonClick: function(e) {
      // eslint-disable-next-line no-alert
      if (confirm(e.target.getAttribute(CustomerAddresses.attributes.confirmMessage))) {
        Shopify.postLink(e.target.getAttribute('data-target'), {
          parameters: {
            _method: 'delete'
          },
        });
      }
    }
  };
  $(function() {
    CustomerAddresses.init();
  });
})(jQuery);