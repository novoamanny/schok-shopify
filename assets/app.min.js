(function($, window) {
  'use strict';

  var $doc = $(document),
    win = $(window),
    body = $('body'),
    wrapper = $('wrapper');

  window.Shopify = window.Shopify || {};
  window.Shopify.theme = window.Shopify.theme || {};
  window.Shopify.theme.sections = window.Shopify.theme.sections || {};

  var SITE = SITE || {};

  gsap.defaults({
    ease: 'power1.out'
  });

  gsap.config({
    nullTargetWarn: false
  });

  window.lazySizesConfig = window.lazySizesConfig || {};
  window.lazySizesConfig.expand = 150;
  window.lazySizesConfig.loadMode = 1;
  window.lazySizesConfig.loadHidden = false;

  SITE = {
    coreLoaded: false,
    init: function() {
      var self = this,
        obj;


      for (obj in self) {
        if (self.hasOwnProperty(obj)) {
          var _method = self[obj];
          if (_method.selector !== undefined && _method.init !== undefined) {
            if ($(_method.selector).length > 0) {
              _method.init();
            }
          }
        }
      }
    },
    headRoom: {
      selector: '.header',
      init: function() {
        var base = this,
          container = $(base.selector),
          parent = container.parents('.header-section');

        win.on('scroll.fixed-header resize.fixed-header', function() {
          base.scroll(container);

          if (!container.hasClass('fixed')) {
						setTimeout( function(){
	            parent.css('min-height', function() {
	              return container.outerHeight(true) + 'px';
	            });
						}, 400);
          }
        }).trigger('scroll.fixed-header');
      },
      scroll: function(container) {
        var animationOffset = 0,
          wOffset = win.scrollTop(),
          stick = 'hover';

        if (wOffset > animationOffset) {
          if (!container.hasClass(stick)) {
            container.addClass(stick);
          }
        } else if ((wOffset < animationOffset && (wOffset > 0))) {
          if (container.hasClass(stick)) {
            container.removeClass(stick);
          }
        } else {
          container.removeClass(stick);
        }
      }

    },
    globalNotification: {
      selector: '.thb-global-notification',
      init: function() {
        var base = this,
          container = $(base.selector),
          close = $('.thb-notification-close', container);

        function adjustMargin() {
          $('.header').css({
            marginTop: container.outerHeight() + 'px'
          });
        }
        win.on('resize.notification', adjustMargin).trigger('resize.notification');

        close.on('click', function() {
          container.slideUp('400', function() {
            container.remove();
            $('.header').css({
              marginTop: 0
            });
            SITE.fixedMe.init();
            Cookies.set('thb-global-notification', '1', {
              expires: 1
            });

            win.trigger('scroll.fixed-header');
            win.off('resize.notification');
          });
        });
      }
    },
    responsiveNav: {
      selector: '#wrapper',
			tlQuickNav: false,
			tlCartNav: false,
			tlMainNav: false,
			tlFilterNav: false,
      init: function() {
        var base = this,
          container = $(base.selector),
          cc = $('.click-capture'),
          menu = $('#mobile-menu'),
          filters = $('#side-filters'),
          cart = $('#side-cart'),
          quick_shop = $('#quick-shop'),
          cc_close = $('.thb-close'),
          span = menu.find('.mobile-menu li.menu-item-has-children>.link-container span');

				if ( ! base.tlMainNav ) {
					base.tlMainNav = gsap.timeline({
	          paused: true,
	          onStart: function() {
	            container.addClass('open-cc');
	            gsap.set($('#mobile-menu'), {
	              visibility: "visible"
	            });
	          },
	          onReverseComplete: function() {
	            container.removeClass('open-cc');
	            gsap.set($('#mobile-menu'), {
	              clearProps: "transform"
	            });
	          }
	        });
				}

				base.tlMainNav
          .to($('#mobile-menu'), {
            x: "0%",
            duration: 0.25
          }, "start")
          .fromTo($('#mobile-menu').find('h6, .searchform, .mobile-menu>li,.mobile-secondary-menu>li, .social-links, .thb-close'), {
            x: "-30",
            opacity: 0
          }, {
            duration: 0.25,
            x: "0",
            opacity: 1,
            stagger: 0.05
          }, "start+=0.2");
				if ( ! base.tlFilterNav ) {
	        base.tlFilterNav = gsap.timeline({
	          paused: true,
	          onStart: function() {
	            container.addClass('open-cc');
	            gsap.set(filters, {
	              visibility: "visible"
	            });
	          },
	          onReverseComplete: function() {
	            container.removeClass('open-cc');
	            gsap.set(filters, {
	              clearProps: "transform"
	            });
							filters.blur();
	          },
						onComplete: function() {
							filters.focus();
						}
	        });
					base.tlFilterNav
	          .to(filters, {
	            x: "0%",
	            duration: 0.25
	          }, "start")
	          .from(filters.find('.widget, .button'), {
	            duration: 0.25,
	            x: "-30",
	            opacity: 0,
	            stagger: 0.05
	          }, "start+=0.2");
				}
				if ( ! base.tlQuickNav ) {
					base.tlQuickNav = gsap.timeline({
						paused: true,
						onStart: function() {
							container.addClass('open-cc');
							gsap.set(quick_shop, {
								visibility: "visible"
							});
						},
						onReverseComplete: function() {
							container.removeClass('open-cc');
							gsap.set(quick_shop, {
								clearProps: "transform"
							});
							quick_shop.blur();
						},
						onComplete: function() {
							quick_shop.focus();
						}
					});
					base.tlQuickNav
	          .to(quick_shop, {
	            x: "0%",
	            duration: 0.25
	          }, "start")
	          .from(quick_shop.find('.product').slice(0,8), {
	            duration: 0.25,
	            x: "30",
	            opacity: 0,
	            stagger: 0.05
	          }, "start+=0.2");
				}
				if ( ! base.tlCartNav ) {
					base.tlCartNav = gsap.timeline({
						paused: true,
						onStart: function() {
							container.addClass('open-cc');
							gsap.set(cart, {
								visibility: "visible"
							});
						},
						onReverseComplete: function() {
							container.removeClass('open-cc');
							gsap.set(cart, {
								clearProps: "transform"
							});
							cart.blur();
						},
						onComplete: function() {
							cart.focus();
						}
					});
					base.tlCartNav
	          .to(cart, {
	            x: "0%",
	            duration: 0.25
	          }, "start")
	          .from($('#side-cart').find('.mini_cart_item, .mini-cart__row, .mini-cart__notes, .mini-cart__buttons'), {
	            duration: 0.25,
	            x: "30",
	            opacity: 0,
	            stagger: 0.05
	          }, "start+=0.2");
				}



        $('.header').on('click', '.mobile-toggle', function() {
          base.tlMainNav.timeScale(1).play();
          return false;
        });
        $('#wrapper').on('click', '.quick-shop', function() {
          base.tlQuickNav.timeScale(1).play();
          return false;
        });
        $('.header').on('click', '#quick_cart', function() {
          if (body.hasClass('template-cart')) {
            return false;
          }
          base.tlCartNav.timeScale(1).play();
          return false;
        });

        cart.on('click', '.remove', function() {
          var variant_id = $(this).data('id');
          $.ajax(theme.routes.cart_change_url + '.js', {
            method: 'POST',
            data: {
              quantity: 0,
              id: variant_id,
              sections: [
                'cart-bubble',
                'cart-side'
              ]
            },
            beforeSend: function() {
              cart.addClass('cart-loading');
            },
            dataType: 'json'
          }).done(function(response) {
            var float_count = $.parseHTML(response.sections['cart-bubble']),
              side_cart = $.parseHTML(response.sections['cart-side']);

            $('#quick_cart .float_count').html($(float_count).find('.float_count').html());
            $('#side-cart .side-panel-content').html($(side_cart).find('.side-panel-content').html());
            cart.removeClass('cart-loading');

						SITE.order_notes.init();
          });
          return false;
        });
        container.on('click', '#thb-shop-filters', function() {
          base.tlFilterNav.timeScale(1).play();
          return false;
        });
				container.on('click', '.filter-apply', function() {
					base.tlFilterNav.timeScale(1.5).reverse();
          return false;
        });
        $('#wrapper').on('click', '.click-capture, .thb-close', function() {
          base.tlMainNav.timeScale(1.5).reverse();
          base.tlCartNav.timeScale(1.5).reverse();
          base.tlQuickNav.timeScale(1.5).reverse();
          base.tlFilterNav.timeScale(1.5).reverse();
          return false;
        });
        $doc.keyup(function(e) {
          if (e.keyCode === 27) {
            base.tlMainNav.timeScale(1.5).reverse();
            base.tlCartNav.timeScale(1.5).reverse();
            base.tlQuickNav.timeScale(1.5).reverse();
            base.tlFilterNav.timeScale(1.5).reverse();
          }
        });
        span.on('click', function(e) {
          var that = $(this),
            parent = that.parent('.link-container'),
            menu = parent.next('.sub-menu');

          if (parent.hasClass('active')) {
            parent.removeClass('active');
            menu.hide();
            parent.blur();
          } else {
            parent.addClass('active');
            menu.show();
          }
          e.stopPropagation();
          e.preventDefault();
        });

        if ($('#side-availability').length) {
          base.availability();
        }
      },
      availability: function() {
        var base = this,
          container = $(base.selector),
          tlAvailabilityNav = gsap.timeline({
            paused: true,
            onStart: function() {
              container.addClass('open-cc');
              gsap.set($('#side-availability'), {
                visibility: "visible"
              });
            },
            onReverseComplete: function() {
              container.removeClass('open-cc');
              gsap.set($('#side-availability'), {
                clearProps: "transform"
              });
            }
          });
        tlAvailabilityNav
          .to($('#side-availability'), {
            x: "0%",
            duration: 0.25
          }, "start")
          .from($('#side-availability').find('.side-availability-product, .pickup-availability-list__item'), {
            duration: 0.25,
            x: "30",
            opacity: 0,
            stagger: 0.05
          }, "start+=0.2");

        $('.thb-product-detail').on('click', '.pickup-availability-information__button', function() {
          tlAvailabilityNav.play();
          return false;
        });
				if (SITE.coreLoaded) {
          return;
        }
        $('#wrapper').on('click', '.click-capture, .thb-close', function() {
          tlAvailabilityNav.reverse();
          return false;
        });
        $doc.keyup(function(e) {
          if (e.keyCode === 27) {
            tlAvailabilityNav.reverse();
          }
        });
      }
    },
    fullMenu: {
      selector: '.thb-full-menu',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.find('li.menu-item-has-children').each(function() {
					if ( $(this).data('loaded')) {
						return;
					}
          var _this = $(this),
            menu = _this.find('>.sub-menu'),
            li = menu.find('>li>a'),
            tl = gsap.timeline({
              paused: true
            });
					_this.data('loaded', true);
          tl
            .to(menu, {
              duration: 0.5,
              autoAlpha: 1
            }, "start")
            .to(li, {
              duration: 0.1,
              opacity: 1,
              x: 0,
              stagger: 0.03
            }, "start");

          _this.hoverIntent(
            function() {
              tl.timeScale(1).play();
            },
            function() {
              tl.timeScale(1.5).reverse();
            }
          );
        });
      }
    },
    jarallax: {
      selector: '.thb-parallax',
      init: function(el) {
        var base = this,
          container = el ? el : $(base.selector);

        container.each(function() {
          var _this = $(this),
            args = {
              speed: 0.8,
              imgElement: '.thb-parallax-image'
            };
          _this.jarallax(args);
        });
      }
    },
    price_slider: {
      selector: '.price_slider_wrapper',
      init: function() {
        var base = this,
          container = $(base.selector),
          slider = $('.price_slider', container),
          labels = $('.price_label', container),
          amounts = $('.price_slider_amount', container),
          args = {
            start: [parseFloat(slider.data('min-value')) || 0, parseFloat(slider.data('max-value') || slider.data('max'))],
            connect: true,
            step: 10,
            range: {
              'min': 0,
              'max': parseFloat(slider.data('max'))
            }
          };
        if (!container.length) {
          return;
        }
        if (slider.hasClass('noUi-target')) {
          slider[0].noUiSlider.destroy();
        }
        noUiSlider.create(slider[0], args);
        slider[0].noUiSlider.on('update', function(values) {
          labels.find('.from').html(Shopify.formatMoney(values[0], theme.settings.moneyFormat));
          labels.find('.to').html(Shopify.formatMoney(values[1], theme.settings.moneyFormat));
        });
        slider[0].noUiSlider.on('change', function(values) {
          amounts.find('.field__input_min').val(values[0]).trigger('change');
          amounts.find('.field__input_max').val(values[1]).trigger('change');
        });
      }
    },
    facets: {
      selector: '#FacetFiltersForm',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.find('input').on('change', function(event) {
          setTimeout(function() {
            base.onSubmitHandler(event);
          }, 500);
        });
				container.find('.filter-clear').on('click', function(event) {
					container[0].reset();
					base.onSubmitHandler(event);
					event.preventDefault();
        });
      },
      updateURLHash: function(searchParams) {
        history.pushState({
          searchParams
        }, '', `${window.location.pathname}${searchParams && '?'.concat(searchParams)}`);
      },
      onSubmitHandler: function(event) {
        var base = this;
        event.preventDefault();
        const formData = new FormData($(base.selector)[0]);
        const searchParams = new URLSearchParams(formData).toString();
        const section_id = $('#main-collection-products').data('id');
        const url = `${window.location.pathname}?section_id=${section_id}&${searchParams}`;
        SITE.facets.renderSectionFromFetch(url);
      },
      renderSectionFromFetch: function(url) {
        $.ajax(url, {
          method: 'GET',
          beforeSend: function() {
            $('#main-collection-products').addClass('thb-loading');
          },
          success: function(response) {
            var resp = $.parseHTML(response),
              new_result_counts = $(resp).find('#result-count').html(),
              new_products = $(resp).find('#main-collection-products').html();
            $('#result-count').html(new_result_counts);
            $('#main-collection-products').html(new_products);

            SITE.shop.init();
          },
          complete: function() {
            $('#main-collection-products').removeClass('thb-loading');
          }
        });
      }
    },
    magnificGallery: {
      selector: '[data-image-feature="lightbox"]',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.each(function() {
          var _this = $(this);

          _this.magnificPopup({
            delegate: 'a',
            type: 'image',
            midClick: true,
            mainClass: 'mfp-zoom-in',
            removalDelay: 400,
            closeBtnInside: true,
            closeMarkup: '<button title="%title%" class="mfp-close"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" width="12" height="12" viewBox="1.1 1.1 12 12" enable-background="new 1.1 1.1 12 12" xml:space="preserve"><path d="M8.3 7.1l4.6-4.6c0.3-0.3 0.3-0.8 0-1.2 -0.3-0.3-0.8-0.3-1.2 0L7.1 5.9 2.5 1.3c-0.3-0.3-0.8-0.3-1.2 0 -0.3 0.3-0.3 0.8 0 1.2L5.9 7.1l-4.6 4.6c-0.3 0.3-0.3 0.8 0 1.2s0.8 0.3 1.2 0L7.1 8.3l4.6 4.6c0.3 0.3 0.8 0.3 1.2 0 0.3-0.3 0.3-0.8 0-1.2L8.3 7.1z"/></svg></button>',
            gallery: {
              enabled: true,
              arrowMarkup: '<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir% mfp-prevent-close"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="slick-nav thb-prev" x="0" y="0" width="50" height="40" viewBox="0 0 50 40" enable-background="new 0 0 50 40" xml:space="preserve"><path class="border" fill-rule="evenodd" clip-rule="evenodd" d="M0 0v40h50V0H0zM48 38H2V2h46V38z"/><path d="M15.3 19.2c0 0 0 0-0.1 0.1 0 0 0 0 0 0 0 0 0 0 0 0 -0.1 0.2-0.2 0.4-0.2 0.7 0 0.2 0.1 0.5 0.2 0.7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0.1l3.8 3.9c0.4 0.4 1.1 0.4 1.5 0 0.4-0.4 0.4-1.1 0-1.6l-2-2h15.3c0.6 0 1.1-0.5 1.1-1.1 0-0.6-0.5-1.1-1.1-1.1H18.6l2-2c0.4-0.4 0.4-1.1 0-1.6 -0.4-0.4-1.1-0.4-1.5 0l-3.8 3.9C15.3 19.2 15.3 19.2 15.3 19.2z"/></svg></button>',
            },
            image: {
              verticalFit: true
            },
            callbacks: {
              imageLoadComplete: function() {
                var _this = this;
                setTimeout(function() {
                  _this.wrap.addClass('mfp-image-loaded');
                }, 10);
              },
              beforeOpen: function() {
                this.st.image.markup = this.st.image.markup.replace('mfp-figure', 'mfp-figure mfp-with-anim');
              },
              open: function() {
                $.magnificPopup.instance.next = function() {
                  var _this = this;
                  _this.wrap.removeClass('mfp-image-loaded');

                  setTimeout(function() {
                    $.magnificPopup.proto.next.call(_this);
                  }, 125);
                };

                $.magnificPopup.instance.prev = function() {
                  var _this = this;
                  this.wrap.removeClass('mfp-image-loaded');

                  setTimeout(function() {
                    $.magnificPopup.proto.prev.call(_this);
                  }, 125);
                };
              }
            }
          });
        });

      }
    },
    magnificInline: {
      selector: '.mfp-inline',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.each(function() {
          var _this = $(this),
            url = _this.attr('href'),
            hash = url,
            extra_class = _this.data('class');

          if (url) {
            hash = url.indexOf("#") !== -1 ? url.substring(url.indexOf("#")) : '';
          }
          _this.magnificPopup({
            type: 'inline',
            midClick: true,
            items: [{
              src: hash,
              type: 'inline'
            }],
            mainClass: 'mfp quick-search ' + extra_class,
            removalDelay: 250,
            closeBtnInside: true,
            overflowY: 'scroll',
            closeMarkup: '<button title="%title%" class="mfp-close"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" width="12" height="12" viewBox="1.1 1.1 12 12" enable-background="new 1.1 1.1 12 12" xml:space="preserve"><path d="M8.3 7.1l4.6-4.6c0.3-0.3 0.3-0.8 0-1.2 -0.3-0.3-0.8-0.3-1.2 0L7.1 5.9 2.5 1.3c-0.3-0.3-0.8-0.3-1.2 0 -0.3 0.3-0.3 0.8 0 1.2L5.9 7.1l-4.6 4.6c-0.3 0.3-0.3 0.8 0 1.2s0.8 0.3 1.2 0L7.1 8.3l4.6 4.6c0.3 0.3 0.8 0.3 1.2 0 0.3-0.3 0.3-0.8 0-1.2L8.3 7.1z"/></svg></button>',
            callbacks: {
              open: function() {
                var that = this;
                setTimeout(function() {
                  $(that.content[0]).find('.search-field').focus().trigger('keyup');
                }, 0);
              }
            }
          });
        });

      }
    },
    magnificVideo: {
      selector: '.mfp-video',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.magnificPopup({
          type: 'iframe',
          closeBtnInside: false,
          closeMarkup: '<button title="%title%" class="mfp-close"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" width="12" height="12" viewBox="1.1 1.1 12 12" enable-background="new 1.1 1.1 12 12" xml:space="preserve"><path d="M8.3 7.1l4.6-4.6c0.3-0.3 0.3-0.8 0-1.2 -0.3-0.3-0.8-0.3-1.2 0L7.1 5.9 2.5 1.3c-0.3-0.3-0.8-0.3-1.2 0 -0.3 0.3-0.3 0.8 0 1.2L5.9 7.1l-4.6 4.6c-0.3 0.3-0.3 0.8 0 1.2s0.8 0.3 1.2 0L7.1 8.3l4.6 4.6c0.3 0.3 0.8 0.3 1.2 0 0.3-0.3 0.3-0.8 0-1.2L8.3 7.1z"/></svg></button>',
          mainClass: 'mfp-zoom-in',
          removalDelay: 250,
          fixedContentPos: true
        });

      }
    },
    autoComplete: {
      selector: '#searchpopup',
      init: function() {
        var base = this,
          container = $(base.selector),
          field = $('.search-field', container),
          results_wrapper = $('.thb-autocomplete-wrapper', container);

        if (!results_wrapper.length) {
          return;
        }
        if (SITE.coreLoaded) {
          return;
        }
        field.on('keyup', function() {
          var _this = $(this),
            q = _this.val();

          if (q.length < 3) {
            results_wrapper.empty().removeClass('thb-loading');
            return;
          }
          $.ajax(theme.routes.predictive_search_url + '?q=' + q + '&resources[type]=product&section_id=predictive-search', {
            method: 'GET',
            beforeSend: function() {
              $('.thb-search-btn', container).remove();
              results_wrapper.addClass('thb-loading');
            }
          }).done(function(response) {
            results_wrapper.removeClass('thb-loading');

            var results = $.parseHTML(response);

            if (results) {
              results_wrapper.html(results);

              results_wrapper.find('.btn').attr('href', theme.routes.search_url + '?q=' + q);

            } else {
              results_wrapper.empty();
            }
          });
        });

      }
    },
		order_notes: {
			selector: '.mini-cart__notes_toggle',
      init: function() {
				var base = this,
          container = $(base.selector);

				container.on('touchstart click', function() {
					$(this).toggleClass('active');

					return false;
				}).on('blur', function() {
					$(this).removeClass('active');
				});
				$('.mini-cart__notes_save').on('click', function() {
          $.ajax({
            method: 'post',
            url: theme.routes.cart_update_url,
            data: {
              note: $('#mini-cart__notes').val()
            }
          });
          $(this).blur();
        });
      }
    },
    zoom: {
      target: function(zoomTargets) {
        zoomTargets.each(function() {
          var zoomTarget = $(this);
          zoomTarget.trigger('zoom.destroy');
          var zoom_options = {
            'url': zoomTarget.data('full'),
            'callback': false,
            'target': zoomTarget,
            'duration': 200, // Transition in milli seconds (default is 120)
            'on': 'mouseover', // other options: grab, click, toggle (default is mouseover)
            'touch': false, // enables a touch fallback
            'onZoomIn': false,
            'onZoomOut': false,
            'magnify': 1, // Zoom magnification: (default is 1  |  float number between 0 and 1)
          };
          if ('ontouchstart' in window) {
            zoom_options.on = 'click';
          }
          zoomTarget.zoom(zoom_options).trigger('focus mouseenter');
          setTimeout(function() {
            zoomTarget.trigger('dragstart mousemove');
          }, 5);
        });

      }
    },
    carousel: {
      selector: '.slick',
      init: function(el) {
        var base = this,
          container = el ? el : $(base.selector);

        container.each(function() {
          var that = $(this),
            columns = that.data('columns'),
            navigation = (that.data('navigation') === true ? true : false),
            autoplay = (that.data('autoplay') === false ? false : true),
						autoplay_speed = (that.data('autoplay-speed') ? parseInt(that.data('autoplay-speed'), 10) : 4000),
            pagination = (that.data('pagination') === true ? true : false),
            disablepadding = (that.data('disablepadding') ? that.data('disablepadding') : false),
            vertical = (that.data('vertical') === true ? true : false),
            asNavFor = that.data('asnavfor');

					if (that.data('slick')) {
            return;
          }
          var args = {
            dots: pagination,
            arrows: navigation,
            infinite: false,
            speed: 600,
            centerMode: false,
            slidesToShow: columns,
            slidesToScroll: 1,
            swipe: false,
						rows: 0,
            autoplay: autoplay,
            autoplaySpeed: autoplay_speed,
            accessibility: false,
            pauseOnHover: true,
            vertical: vertical,
            focusOnSelect: true,
            prevArrow: '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="slick-nav thb-prev" x="0" y="0" width="50" height="40" viewBox="0 0 50 40" enable-background="new 0 0 50 40" xml:space="preserve"><path class="border" fill-rule="evenodd" clip-rule="evenodd" d="M0 0v40h50V0H0zM48 38H2V2h46V38z"/><path d="M15.3 19.2c0 0 0 0-0.1 0.1 0 0 0 0 0 0 0 0 0 0 0 0 -0.1 0.2-0.2 0.4-0.2 0.7 0 0.2 0.1 0.5 0.2 0.7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0.1l3.8 3.9c0.4 0.4 1.1 0.4 1.5 0 0.4-0.4 0.4-1.1 0-1.6l-2-2h15.3c0.6 0 1.1-0.5 1.1-1.1 0-0.6-0.5-1.1-1.1-1.1H18.6l2-2c0.4-0.4 0.4-1.1 0-1.6 -0.4-0.4-1.1-0.4-1.5 0l-3.8 3.9C15.3 19.2 15.3 19.2 15.3 19.2z"/></svg>',
            nextArrow: '<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="slick-nav thb-next" x="0" y="0" width="50" height="40" viewBox="0 0 50 40" enable-background="new 0 0 50 40" xml:space="preserve"><path class="border" fill-rule="evenodd" clip-rule="evenodd" d="M0 0v40h50V0H0zM2 2h46v36H2V2z"/><path d="M34.7 19.2L30.9 15.3c-0.4-0.4-1.1-0.4-1.5 0 -0.4 0.4-0.4 1.1 0 1.6l2 2H16.1c-0.6 0-1.1 0.5-1.1 1.1 0 0.6 0.5 1.1 1.1 1.1h15.3l-2 2c-0.4 0.4-0.4 1.1 0 1.6 0.4 0.4 1.1 0.4 1.5 0l3.8-3.9c0 0 0 0 0.1-0.1 0 0 0 0 0 0 0 0 0 0 0 0 0.1-0.2 0.2-0.4 0.2-0.7 0-0.2-0.1-0.5-0.2-0.7 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0-0.1-0.1C34.7 19.2 34.7 19.2 34.7 19.2z"/></svg>',
            responsive: [{
              breakpoint: 1441,
              settings: {
                slidesToShow: (columns < 6 ? columns : (vertical ? columns - 1 : 6))
              }
            },
            {
              breakpoint: 1201,
              settings: {
                slidesToShow: (columns < 4 ? columns : (vertical ? columns - 1 : 4))
              }
            },
            {
              breakpoint: 1069,
              settings: {
                slidesToShow: (columns < 3 ? columns : (vertical ? columns - 1 : 3))
              }
            },
            {
              breakpoint: 769,
              settings: {
                slidesToShow: 1
              }
            }]
          };
          if (asNavFor && $(asNavFor).is(':visible')) {
            args.asNavFor = asNavFor;
          }
          if (that.data('fade')) {
            args.fade = true;
          }
          if (that.hasClass('product-images')) {
            args.adaptiveHeight = true;
            args.fade = true;
            that.on('init', function(event, slick) {
              SITE.model3d.initialize();
            });
            // Zoom Support
            if (that.data('image-feature') === 'zoom') {
              that.on('init', function(event, slick) {
								if ( slick.$slides ) {
	                var zoomTarget = slick.$slides.eq(0).find('.zoom');

	                SITE.zoom.target(zoomTarget);
								}
              });
              that.on('afterChange', function(event, slick, currentSlide) {
								if ( slick.$slides ) {
	                var zoomTarget = slick.$slides.eq(currentSlide).find('.zoom');

	                SITE.zoom.target(zoomTarget);
								}
              });
            }

						// Video support
						that.on('beforeChange', function(event, slick, currentSlide, nextSlide){
							var slide = slick.$slides.eq(currentSlide),
									media = slide.find('.product-single__media');

							if ( media.hasClass('product-single__media-external-video')) {
								if (media.data('provider') === 'youtube') {
									media.find('iframe').get(0).contentWindow.postMessage(JSON.stringify({ event: "command", func: "pauseVideo", args: "" }), "*");
								} else if (media.data('provider') === 'vimedo') {
									media.find('iframe').get(0).contentWindow.postMessage(JSON.stringify({ method: "pause" }), "*");
								}
							} else if ( media.hasClass('product-single__media-native-video') ) {
								media.find("video").get(0).pause();
							}
						});
          }
          if (that.hasClass('product-thumbnails')) {
            args.vertical = true;
						args.variableHeight = true;
            args.responsive[2].settings.vertical = false;
            args.responsive[2].settings.slidesToShow = 4;
            args.responsive[3].settings.vertical = false;
            args.responsive[3].settings.slidesToShow = 4;
          }
          if (that.hasClass('testimonial-style3')) {
            args.customPaging = function(slider, i) {
              var portrait = $(slider.$slides[i]).find('.author_image'),
                title = $(slider.$slides[i]).find('.title').text(),
                portrait_html = portrait.length ? portrait.get(0).outerHTML : '';

              return '<a class="portrait_bullet" title="' + title + '">' + portrait_html + '</a>';
            };
          }
					if (that.hasClass('thb-hotspots-products-carousel')) {
						that.on('beforeChange', function(event, slick, currentSlide, nextSlide){
							var hotspot_wrapper = that.parents('.thb-hotspot-wrapper'),
									hotspots = hotspot_wrapper.find('.thb-hotspot');

							hotspots.removeClass('active');
							hotspots.eq(nextSlide).addClass('active');
						});
					}
          that.slick(args);
          if (window.Shopify.designMode || window.Shopify.hasSections) {
            setTimeout(function() {
              win.trigger('resize');
            }, 200);
          }
        });
      }
    },
    loginForm: {
      selector: '.thb-overflow-container',
      init: function() {
        var base = this,
          container = $(base.selector),
          ul = $('ul', container),
          links = $('a', ul);

        links.on('click', function() {
          var _this = $(this);
          if (!_this.hasClass('active')) {
            links.removeClass('active');
            _this.addClass('active');

            $('.thb-form-container', container).toggleClass('register-active');
          }
          return false;
        });

        $('.forget-password-toggle').on('click', function() {
          $('.thb-login-form').toggleClass('forgot');
        });
      }
    },
    shop: {
      selector: '.products .product',
      init: function() {
        var base = this,
          container = $(base.selector);

        if (SITE.coreLoaded) {
          return;
        }
        container.each(function() {
          var _this = $(this);

          _this.find('.ajax_add_to_cart:not(.outofstock)').on('click', function() {
            var btn = $(this),
              variant_id = btn.data('id'),
              btn_org_text = btn.text(),
              btn_adding_text = btn.data('addingtocart');
            $.ajax(theme.routes.cart_add_url, {
              method: 'POST',
              data: {
                quantity: 1,
                id: variant_id,
                sections: [
                  'cart-bubble',
                  'cart-side'
                ]
              },
              beforeSend: function() {
                _this.addClass('thb-loading');
                btn.text(btn_adding_text);
              },
              dataType: 'json'
            }).done(function(response) {
              _this.removeClass('thb-loading');
              btn.text(btn_org_text);

              var float_count = $.parseHTML(response.sections['cart-bubble']),
                side_cart = $.parseHTML(response.sections['cart-side']);

              $('#quick_cart .float_count').html($(float_count).find('.float_count').html());
              $('#side-cart .side-panel-content').html($(side_cart).find('.side-panel-content').html());

							SITE.order_notes.init();

							var latency = 100,
									cc = false;
							if ( _this.parents('#quick-shop').length) {
								SITE.responsiveNav.tlQuickNav.timeScale(1.5).reverse();
								latency = 750;
								cc = true;
							}
							setTimeout(function() {
								$('#quick_cart').trigger('click');
								if ( cc ) {
									body.addClass('open-cc');

								}
							}, latency);
            });
            return false;
          });
        }); // each

      }
    },
    variations_form: {
      selector: '.js-product-options',
      init: function() {
        var base = this,
          container = $(base.selector),
          product_page = $('.thb-product-detail'),
          price_container = $('span.price', product_page),
          org_price = price_container.html(),
          slider = $('#product-images'),
					form = container.parents('.shopify-product-form'),
					error_wrapper = form.find('.form-notification'),
          thumbnails = $('#product-thumbnails');

        if (SITE.coreLoaded) {
          return;
        }
        var productOptionSelectors = new Shopify.OptionSelectors2(container[0], {
          product: window.theme.product_json,
          onVariantSelected: function callback(variant, container) {
						error_wrapper.hide();
            if (variant) {
              var price = Shopify.formatMoney(variant.price, theme.settings.money_with_currency_format),
                	compare_at_price = Shopify.formatMoney(variant.compare_at_price, theme.settings.money_with_currency_format),
                	i = 0;

              price_container.html('<ins><span class="amount">' + price + '</span></ins>');

              if (variant.compare_at_price) {
                price_container.prepend('<del><span class="amount">' + compare_at_price + '</span></del>');
              }
              if (variant.unit_price) {
                var unitprice = Shopify.formatMoney(variant.unit_price, theme.settings.money_with_currency_format);
                price_container.append('<small class="unit-price"><span class="amount">' + unitprice + '</span> <span class="unit-price-separator">/</span> <span>' + variant.unit_price_measurement.reference_value + variant.unit_price_measurement.reference_unit + '</span></small>');
              }
              if (variant.featured_media) {
                i = parseInt($('div[data-id="' + variant.featured_media.id + '"]', thumbnails).data('slick-index'), 10);

								if (thumbnails && thumbnails.hasClass('slick-initialized')) {
	                slider.slick('slickGoTo', i);
	              }
								if ( ! slider.hasClass('slick') ) {
									let first_slide = slider.find('.product-image:eq(0)'),
											y = first_slide.offset().top + 'px';
									first_slide.attr('data-full', variant.featured_media.preview_image.src);
									first_slide.find('a').attr('href', variant.featured_media.preview_image.src);
									first_slide.find('img').attr('data-src', variant.featured_media.preview_image.src);
									first_slide.find('img').attr('src', variant.featured_media.preview_image.src);
									first_slide.find('img').attr('data-srcset', '');
									first_slide.find('img').attr('srcset', '');
									first_slide.find('img').attr('width', variant.featured_media.preview_image.width);
									first_slide.find('img').attr('height', variant.featured_media.preview_image.height);


									first_slide[0].scrollIntoView({behavior: 'smooth'});
								}
              }

              if (!variant.available) {
                $('.single_add_to_cart_button').attr('disabled', 'disabled').find('span').text(window.theme.strings.soldOut);
              } else {
                $('.single_add_to_cart_button').removeAttr('disabled').find('span').text(window.theme.strings.addToCart);
              }

              base.productAvailability(variant);
            } else {
              $('.single_add_to_cart_button').attr('disabled', 'disabled').find('span').text(window.theme.strings.unavailable);
            }

          },
          enableHistoryState: true
        });
      },
      productAvailability: function(variant) {
        $.ajax('/variants/' + variant.id + '/?section_id=pickup-availability', {
          method: 'GET',
          beforeSend: function() {
            $('.pickup-availability-wrapper').addClass('thb-loading');
          },
          success: function(response) {
            var resp = $.parseHTML(response),
              new_availability = $(resp).find('.pickup-availability-information').prop("outerHTML") || '',
							new_drawer = $(resp).find('#side-availability').html();

            $('.pickup-availability-wrapper').html(new_availability);
						$('#side-availability').html(new_drawer);
          },
          complete: function() {
            $('.pickup-availability-wrapper').removeClass('thb-loading');
            SITE.responsiveNav.availability();
          }
        });
      },
    },
    single_add_to_cart_button: {
      selector: '.single_add_to_cart_button',
      init: function() {
        var base = this,
          container = $(base.selector),
          form = container.parents('.shopify-product-form'),
          error_wrapper = form.find('.form-notification');

        if (SITE.coreLoaded) {
          return;
        }
        container.on('click', function() {
          var data = form.serializeJSON();
          data.sections = [
            'cart-bubble',
            'cart-side'
          ];
          data.sections_url = window.location.pathname;

          $.ajax({
            method: 'post',
            url: theme.routes.cart_add_url,
            beforeSend: function() {
              container.addClass('thb-loading');
              error_wrapper.hide();
              $('.shopify-payment-button').hide();
            },
            headers: {
              "Accept": "application/javascript"
            },
            dataType: "json",
            contentType: 'application/json',
            data: JSON.stringify(data),
            error: function(xhr) {
              var response = JSON.parse(xhr.responseText);

              error_wrapper.html(response.description).show();
            },
            success: function(response) {
              var float_count = $.parseHTML(response.sections['cart-bubble']),
                side_cart = $.parseHTML(response.sections['cart-side']);

              $('#quick_cart .float_count').html($(float_count).find('.float_count').html());
              $('#side-cart .side-panel-content').html($(side_cart).find('.side-panel-content').html());

							SITE.order_notes.init();
              setTimeout(function() {
                $('#quick_cart').trigger('click');
              }, 100);
            },
            complete: function() {
              $('.shopify-payment-button').show();
              container.removeClass('thb-loading');
            },
          });
          return false;
        });
      }
    },
    quantity: {
      selector: '.quantity:not(.hidden)',
      init: function() {
        var base = this,
          container = $(base.selector);

        base.initialize();

      },
      initialize: function() {
        // Quantity buttons
        $('div.quantity:not(.buttons_added), td.quantity:not(.buttons_added)').addClass('buttons_added').append('<input type="button" value="+" class="plus" />').append('<input type="button" value="-" class="minus" />').end().find('input[type="number"]').attr('type', 'text');
        $('.plus, .minus').on('click', function() {
          // Get values
          var $qty = $(this).closest('.quantity').find('.qty'),
            currentVal = parseFloat($qty.val()),
            max = parseFloat($qty.attr('max')),
            min = parseFloat($qty.attr('min')),
            step = $qty.attr('step');

          // Format values
          if (!currentVal || currentVal === '' || currentVal === 'NaN') {
            currentVal = 0;
          }
          if (max === '' || max === 'NaN') {
            max = '';
          }
          if (min === '' || min === 'NaN') {
            min = 1;
          }
          if (step === 'any' || step === '' || step === undefined || parseFloat(step) === 'NaN') {
            step = 1;
          }

          // Change the value
          if ($(this).is('.plus')) {

            if (max && (max === currentVal || currentVal > max)) {
              $qty.val(max);
            } else {
              $qty.val(currentVal + parseFloat(step));
            }

          } else {

            if (min && (min === currentVal || currentVal < min)) {
              $qty.val(min);
            } else if (currentVal > 0) {
              $qty.val(currentVal - parseFloat(step));
            }

          }

          // Trigger change event
          $qty.trigger('change');
          return false;
        });
      }
    },
    cart_update: {
      selector: '.quantity.cart-update',
      init: function() {
        var base = this,
          container = $(base.selector),
          cart = $('.thb-cart-form');

        if (SITE.coreLoaded) {
          return;
        }
				$('.cart-update-mobile').prop('disabled', false);
        cart.on('change', base.selector, function() {
          var _this = $(this),
            key = _this.data('id');

          $.ajax({
            method: 'post',
            url: theme.routes.cart_change_url,
            beforeSend: function() {
              cart.addClass('thb-loading');
            },
            dataType: "json",
            data: {
              quantity: _this.find('.qty').val(),
              line: _this.parents('tr').index() + 1,
              sections: [
								'cart-bubble',
                'main-cart'
              ],
              sections_url: window.location.pathname,
            },
            success: function(response) {
              var resp = $.parseHTML(response.sections['main-cart']),
									float_count = $.parseHTML(response.sections['cart-bubble']);
              $('.thb-cart-form').html($(resp).find('.thb-cart-form-container'));
              $('#quick_cart .float_count').html($(float_count).find('.float_count').html());
              SITE.quantity.init();
            },
            complete: function() {
              cart.removeClass('thb-loading');
            },
          });
        });

      }
    },
    sortBy: {
      selector: '#sort_by',
      init: function(el) {
        var base = this,
          container = el ? el : $(base.selector);

        if (SITE.coreLoaded) {
          return;
        }
				function select_size() {
					var text = container.find('option:selected').text();
				  var $aux = $('<select/>').append($('<option/>').text(text));
				  container.after($aux);
				  container.width($aux.width() + 10);
				  $aux.remove();
				}
				select_size();
        container.on('change', function(event) {
					select_size();
					SITE.facets.onSubmitHandler(event);
          return false;
        });
      }
    },
    model3d: {
      selector: 'model-viewer',
      initialize: function(el) {
        var base = this,
          container = $(base.selector);

        if (!container.length) {
          return;
        }
        window.Shopify.loadFeatures([{
          name: 'model-viewer-ui',
          version: '1.0',
          onLoad: (function() {
            $(this).data('player', new Shopify.ModelViewerUI(base.selector));
          }).bind(this)
        }]);
        window.ProductModel = {
          loadShopifyXR() {
            Shopify.loadFeatures([{
              name: 'shopify-xr',
              version: '1.0',
              onLoad: this.setupShopifyXR.bind(this),
            }, ]);
          },

          setupShopifyXR(errors) {
            if (errors) return;

            if (!window.ShopifyXR) {
              document.addEventListener('shopify_xr_initialized', () =>
                this.setupShopifyXR()
              );
              return;
            }
            document.querySelectorAll('[id^="ProductJSON-"]').forEach((modelJSON) => {
              window.ShopifyXR.addModels(JSON.parse(modelJSON.textContent));
              modelJSON.remove();
            });
            window.ShopifyXR.setupXRElements();
          },
        };

        if (Shopify.designMode) {
          document.querySelectorAll("[data-shopify-xr-hidden]").forEach(element => element.classList.add('hidden'));
        }
        if (window.ProductModel) {
          window.ProductModel.loadShopifyXR();
        }


      }
    },
    fixedMe: {
      selector: '.thb-product-style2 .summary, .thb-product-style4 .summary, .thb-product-style5 .summary',
      init: function(el) {
        var base = this,
          container = el ? el : $(base.selector),
          ah = $('.header').outerHeight() + ($('.thb-global-notification').outerHeight() || 0);

        container.css('top', ah);
      }
    },
    productZoom: {
      selector: '.thb-product-style2, .thb-product-style4, .thb-product-style5',
      init: function(el) {
        var base = this,
          container = el ? el : $(base.selector);

        container.each(function() {
          var _this = $(this),
            zoomTargets = $('#product-images .zoom', _this);

          SITE.zoom.target(zoomTargets);
        });
      }
    },
    retinaJS: {
      selector: 'img.retina_size:not(.retina_active)',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.each(function() {
          var _this = $(this);
          _this.attr('width', function() {
            var w = $(this).attr('width') / 2;
            return w;
          });
          if (_this.attr('height')) {
            _this.attr('height', function() {
              var h = $(this).attr('height') / 2;
              return h;
            });
          }
          _this.addClass('retina_active');
        });

      }
    },
    masonry: {
      selector: '.masonry',
      init: function() {
        var base = this,
          container = $(base.selector);

        if (SITE.coreLoaded) {
          return;
        }
        container.each(function() {
          var _this = $(this),
	            args = {
	              layoutMode: 'masonry',
	              itemSelector: '.item'
	            };
							_this.isotope(args);
          _this.imagesLoaded(function() {
            _this.isotope('layout');
          });
					var update = function(){
        		_this.isotope('layout');
			    };

			    // Note: Instead of waiting for all images until we initialize the widget
			    // we use event capturing to update the widget's layout progressively.
			    this.addEventListener('load', update, true);
        });
      }
    },
    shareArticleDetail: {
      selector: '.share-article',
      init: function() {
        var base = this,
          container = $(base.selector),
          link = container.find('.thb_share'),
          icons = container.find('.icons'),
          social = container.find('.social'),
          tl = gsap.timeline({
            paused: true,
            onStart: function() {
              icons.css('display', 'block');
            },
            onReverseComplete: function() {
              icons.css('display', 'none');
            }
          });

        link.on('click', function() {
          return false;
        });

        social.on('click', function() {
          var left = (screen.width / 2) - (640 / 2),
            top = (screen.height / 2) - (440 / 2) - 100;
          window.open($(this).attr('href'), 'mywin', 'left=' + left + ',top=' + top + ',width=640,height=440,toolbar=0');
          return false;
        });

        tl
          .fromTo(icons, {
            y: '6',
            x: '-50%',
            autoAlpha: 0
          }, {
            duration: 0.25,
            y: '-2',
            x: '-50%',
            autoAlpha: 1
          });

        container.hoverIntent(function() {
          tl.timeScale(1).play();
        }, function() {
          tl.timeScale(1.5).reverse();
        });
      }
    },
    shopSidebar: {
      selector: '#side-filters .widget',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.each(function() {
          var _this = $(this),
            t = _this.find('>h6'),
            groups = _this.find('ul.color, ul.link');

          t.append($('<span/>')).on('click', function() {
            t.toggleClass('active');
            t.next().animate({
              height: "toggle",
              opacity: "toggle"
            }, 300);
          });

          groups.each(function() {
            var ul = _this,
              links = ul.find('.filter-link');

            if (!$('.current-cat', ul).length) {
              return;
            }
            links.on('click', function(e) {
              e.preventDefault();
              var url = $(this).attr('href'),
                activeHandle = $('.current-cat', ul).data('handle') + '+';
              url = url.replace(activeHandle, '');
              window.location = url;
            });
          });
        });
      }
    },
    cookieBar: {
      selector: '.thb-cookie-bar',
      init: function() {
        var base = this,
          container = $(base.selector),
          button = $('.button-accept', container);

        if (Cookies.get('thb-north-cookiebar') !== 'hide') {
          gsap.to(container, {
            duration: 0.5,
            opacity: '1',
            y: '0%'
          });
        }
        button.on('click', function() {
          Cookies.set('thb-north-cookiebar', 'hide', {
            expires: 30
          });
          gsap.to(container, {
            duration: 0.5,
            opacity: '0',
            y: '100%'
          });
          return false;
        });
      }
    },
    hotspot: {
      selector: '.thb-hotspot-wrapper',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.each(function() {
          var _this = $(this),
            hotspots = _this.find('.thb-hotspot'),
            target = container.find('.slick');

          if (SITE.coreLoaded) {
            return;
          }
          hotspots.on('hover ontouchstart mouseenter click', function() {
            var hotspot = $(this),
								i = hotspots.index(hotspot);

						hotspots.removeClass('active');
						hotspot.addClass('active');

            target.slick('slickGoTo', i);
          });
        });
      }
    },
    localization: {
      selector: '.thb-language-code, .thb-currency-code',
      init: function() {
        var base = this,
          container = $(base.selector);

        container.on('change', function() {
          var form = $(this).parents('.shopify-localization-form');

          form.submit();
        });
      }
    },
    animation: {
      selector: '.animation',
      init: function() {
        var base = this,
          container = $(base.selector);

        base.control(container, true);

        win.on('scroll.thb-animation', function() {
          base.control(container, true);
        }).trigger('scroll.thb-animation');
      },
      container: function(container) {
        var base = this,
          element = $(base.selector, container);

        base.control(element, false);
      },
      control: function(element, filter) {
        var t = 0,
          delay = 0.2,
          el = filter ? element.filter(':in-viewport') : element;

        el.each(function() {
          var _this = $(this),
            params = {
              autoAlpha: 1,
              x: 0,
              y: 0,
              z: 0,
              duration: 0.75,
              rotationZ: '0deg',
              rotationX: '0deg',
              rotationY: '0deg',
              delay: t * delay
            };

          if (_this.data('thb-animated') !== true) {
            _this.data('thb-animated', true);

            if (_this.hasClass('scale')) {
              params.scale = 1;
            }
            gsap.to(_this, params);
            t++;
          }
        });
      }
    }
  };

  $(function() {
		SITE.init();
    SITE.coreLoaded = true;

    if (window.Shopify.designMode || window.Shopify.hasSections) {
      $(document).on('shopify:section:select shopify:block:select shopify:section:load', function(event) {
        var id = event.detail.sectionId,
						type = event.type;

				if ( type == 'shopify:section:load' ) {
					SITE.init();
				}

        win.trigger('scroll.thb-animation');
      });
    }
  });


})(jQuery, this);
